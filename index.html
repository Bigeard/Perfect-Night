<!doctypehtml><html><head><meta charset=utf-8><meta content="text/html; charset=utf-8"http-equiv=Content-Type><title>Perfect Night</title><meta content="Perfect Night"name=title><meta content="Multi Player Video Game | Perfect Night"name=description><meta content="perfectnight, multiplayer, videogame"name=keywords><meta content="width=device-width"name=viewport><link href=favicon.ico rel="shortcut icon"><script src=js/peerjs.min.js></script><script src=js/qrenc3.min.js></script><script src=js/virtualgamepad.js></script><script src=js/filesaver.min.js></script><script>function saveFileFromMEMFSToDisk(e,a){var i,o=FS.readFile(e);i=new Blob([o.buffer],{type:"application/octet-binary"}),saveAs(i,a)}</script><style>html{background:#000;margin:0!important;padding:0!important}body{margin:0;display:flex;align-items:center;justify-content:center;height:100vh;margin:0!important;padding:0!important}canvas{width:100%}#peerjs{display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#cdcdcd;padding:15px;border-radius:10px;border:double 3px #000;width:60%;height:60%;justify-content:space-around}.message-container{width:100%}.info-container{width:100%}</style></head><body><canvas id=canvas oncontextmenu=event.preventDefault() tabindex=-1></canvas><div id=peerjs><div class=message-container><span>Messages:<span id=message></span></span><br><input id=sendMessageBox placeholder="Enter a message..."><button onclick=sendMessage() id=sendMessageButton>></button></div><div class=info-container><span>Status:<span id=status></span></span><div style=font-weight:700 title="Copy this ID to the input on send.html.">ID: <input id=receiverId><button onclick=copyToClipboard()>Copy ID</button><canvas id=qrcanv></canvas></div></div></div><script>var Module={canvas:document.getElementById("canvas")},peerjs=document.getElementById("peerjs");togglePeerJs=()=>("flex"===peerjs.style.display?peerjs.style.display="none":peerjs.style.display="flex",1);var gamepadUrl="n",lastPeerId=null,peer=null,status=document.getElementById("status"),message=document.getElementById("message"),sendMessageBox=document.getElementById("sendMessageBox"),recvId=document.getElementById("receiverId");(()=>{setupqr(),copyToClipboard=()=>{recvId.select(),navigator.clipboard.writeText()};sendMessageBox.addEventListener("keypress",(function(e){"13"===e.keyCode&&sendMessage()})),peer=new Peer({secure:!0,host:"perfect-night-374900.oa.r.appspot.com",port:443,path:"/peer",iceServers:[{urls:["stun:stun3.l.google.com:19302"]}],debug:2}),console.log(peer),peer.on("open",(e=>{null===peer.id?(console.log("Received null id from peer open"),peer.id=lastPeerId):lastPeerId=peer.id,recvId.value=peer.id,gamepadUrl=window.location.href+"g.htm?i="+peer.id,doqr(gamepadUrl),console.log(gamepadUrl),status.innerHTML="Awaiting connection..."})),peer.on("connection",(e=>{if(listGamepad.size>=8)return void e.on("open",(()=>{e.send("Error: To many players"),setTimeout((()=>e.close()),500)}));const s=new VirtualGamepad(e,e.peer,listGamepad.size);listGamepad.set(s.id,s);const n=listGamepad.forEach((e=>e.name+" | "));status.innerHTML="Connected to: "+n})),peer.on("disconnected",(()=>{status.innerHTML="Connection lost. Please reconnect",peer.id=lastPeerId,peer._lastServerId=lastPeerId,listGamepad.get(peer.id).disconnect(),peer.reconnect()})),peer.on("close",(()=>{listGamepad.forEach((e=>e.disconnect())),status.innerHTML="Connection destroyed. Please refresh"})),peer.on("error",(e=>alert(""+e)))})();const sendMessage=()=>{console.log("press code"),listGamepad.forEach((e=>{if(e.conn&&e.conn.open){var s=sendMessageBox.value;e.conn.send(s),addMessage('<span class="selfMsg">Self: </span>'+s)}else console.error("Connection is closed")})),sendMessageBox.value=""},addMessage=e=>{var s=new Date,n=s.getHours();const o=e=>(e<10&&(e="0"+e),e);var t=o(s.getMinutes()),r=o(s.getSeconds());n>12?n-=12:0===n&&(n=12),message.innerHTML='<br><span class="msg-time">'+n+":"+t+":"+r+"</span>  -  "+e+message.innerHTML}</script><script src=index.js async></script></body></html>