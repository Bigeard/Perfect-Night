<!doctypehtml><html><head><meta charset=utf-8><meta content="text/html; charset=utf-8"http-equiv=Content-Type><title>Perfect Night</title><meta content="Perfect Night"name=title><meta content="Multi Player Video Game | Perfect Night"name=description><meta content="perfectnight, multiplayer, videogame"name=keywords><meta content="width=device-width"name=viewport><link href=favicon.ico rel="shortcut icon"><script src=js/config/uk.js></script><script src=js/lib/peerjs.min.js></script><script src=js/lib/filesaver.min.js></script><script src=js/gamesettings.js></script><script src=js/sharesceen.js></script><script src=js/virtualgamepad.js></script><script>function saveFileFromMEMFSToDisk(e,i){const o=FS.readFile(e),a=new Blob([o.buffer],{type:"application/octet-binary"});saveAs(a,i)}</script><style>html{background:#212530;margin:0;padding:0}body{display:flex;align-items:center;justify-content:center;height:100vh;margin:0;padding:0}canvas{width:100%}#divShareScreen{position:absolute;top:0;border-radius:20px}#divCopyLink{position:absolute;bottom:0;border-radius:20px}#inputCopyLink,#inputShareScreen{width:450px;padding:10px;border-radius:20px 0 0 20px;border:none;margin:0}#buttonCopyLink,#buttonShareScreen{padding:10px;border-radius:0 20px 20px 0;border:none;margin:0}</style></head><body><canvas id=canvas oncontextmenu=event.preventDefault() tabindex=-1></canvas><div id=divShareScreen><input id=inputShareScreen><button id=buttonShareScreen onclick=clickShareScreen()>Connect</button></div><div id=divCopyLink><input id=inputCopyLink value=Wait...><button id=buttonCopyLink onclick=clickCopyLink()>Copy the link</button></div><script>console.info(Config);let PeerServerId=null;const inputShareScreen=document.getElementById("inputShareScreen"),buttonShareScreen=document.getElementById("buttonShareScreen");clickShareScreen=()=>{peer&&(peer.disconnect(),peer=null,PeerServerId=inputShareScreen.value,init(),buttonShareScreen.innerText="Successfully added ✅ !")};const divCopyLink=document.getElementById("divCopyLink"),inputCopyLink=document.getElementById("inputCopyLink"),buttonCopyLink=document.getElementById("buttonCopyLink");clickCopyLink=()=>{inputCopyLink.select(),inputCopyLink.setSelectionRange(0,99999),window.isSecureContext&&navigator.clipboard?navigator.clipboard.writeText(inputCopyLink.value):document.execCommand("copy"),buttonCopyLink.innerText="Successfully copied ✅ !"};var Module={canvas:document.getElementById("canvas")};let gamepadUrl="n",lastPeerId=null,peer=null,conn=null;const init=()=>{peer=new Peer(Config),console.info(peer),peer.on("open",(e=>{null===peer.id?(console.info("Received null id from peer open"),peer.id=lastPeerId):lastPeerId=peer.id,gamepadUrl=window.location.href+"g.htm?i="+peer.id,inputCopyLink.value=gamepadUrl,console.info(gamepadUrl),PeerServerId&&join()})),peer.on("connection",(e=>{if(e.metadata&&"screenShare"===e.metadata.type)return listScreenShare[listScreenShareIndex]=e,listScreenShareIndex++,void console.log(e);let n=!1;if(listGamepad.forEach((o=>o.conn?.peer===e.peer?n=o:0)),n)n.conn=e,n.connect();else if(e.metadata&&e.metadata.id)n=listGamepad.get(e.metadata.id),n.conn=e,n.connect();else{if(listGamepad.size>=8)return void e.on("open",(()=>{e.send("Error: To many players"),setTimeout((()=>e.close()),500)}));n=new VirtualGamepad(e,e.peer,listGamepad.size),listGamepad.set(n.id,n)}const o=[];listGamepad.forEach((e=>o.push({name:e.name,peerId:e.conn?.peer}))),console.info("Player connected: ",o)})),peer.on("disconnected",(()=>{console.info("Connection lost. Please reconnect"),peer.id=lastPeerId,peer._lastServerId=lastPeerId,peer.reconnect()})),peer.on("close",(()=>{console.info("Connection destroyed. Please refresh"),peer.reconnect()})),peer.on("error",(e=>console.error(e)))},join=()=>{conn&&conn.close(),conn=peer.connect(PeerServerId,{metadata:{type:"screenShare"},reliable:!1,serialization:"none"}),conn.on("open",(()=>{console.info("Connected to ",conn.peer)})),conn.on("data",(e=>{const n=JSON.parse(e);let o=Date.now();console.log("Ping:",o-n.t),console.log("Time phone:",n.t),console.log("Time screen:",o),console.log(n)}))};init()</script><script src=index.js async></script></body></html>